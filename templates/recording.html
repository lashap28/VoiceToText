<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>R&D Team Services</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/jumbotron/">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>


<body style="background-color:#f7f7f7">
  <nav class="navbar navbar-expand-xl navbar-light fixed-top mb-4" style="background-color:#d6d6f5">
      <button type="button" class="btn btn-flat ml-2"><i class="fa fa-rocket fa-3x"></i></button>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarToggle">
        <div class="navbar-nav mr-auto">
          <a class="nav-item nav-link" href="{{ url_for('root') }}">მთავარი</a>
        </div>

        <div class="navbar-nav">
            <a class="nav-item nav-link" href="{{ url_for('about') }}">ზოგადი</a>
        </div>
      </div>
  </nav>
  <div class="container d-flex align-items-center justify-content-center" style="height: 700px ">

        <div class=“row” style="width:100%">
            <div class="h-100 d-flex align-items-center justify-content-center border-bottom" > <h1 id="rndWord">{{word}}</h1> </div>
            <div class="h-100 d-flex align-items-center justify-content-center" style="margin-bottom: 45px;"> <h1 id="safeTimerDisplay">00:00</h1> </div>
            <div class="col" id="msg" style="color:red; visibility: hidden;">hm</div>

                <div class="row btn-group" role="group" style="width:100%">
                    <button type="button" id="startRecording" class="btn btn-outline-danger"><i class="fa fa-microphone"  aria-hidden="true"></i></button>
                    <button type="button" id="stopRecording" class="btn btn-outline-info"><i class="fa fa-stop" aria-hidden="true"></i></button>
                    <button type="button" id="nextWord" class="btn btn-outline-success" disabled="true"><i class="fa fa-chevron-right" aria-hidden="true"></i></button>
                </div>

        </div>
    </div>
 </div>
   <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <!--ALOHA OE -->
    <!-- ALOHA OE -->

    <!-- footer-->
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
      <symbol id="facebook" viewBox="0 0 16 16">
        <path d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951z"/>
      </symbol>
    </svg>

    <div class="fixed-bottom">
      <footer class="d-flex flex-wrap justify-content-between align-items-center py-3 my-4 border-top ">
          <div class="container col-md-4 d-flex align-items-center ">
              <span class="mb-3 mb-md-0 text-muted">&copy; 2022 Company, Inc</span>
          </div>
          <ul class="container nav col-md-4 justify-content-end list-unstyled d-flex">
            <li class="ms-3"><a class="text-muted" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"/></svg></a></li>
          </ul>
      </footer>
    </div>
</body>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
 navigator
        .mediaDevices
        .getUserMedia({audio: true})
        .then(stream => { handlerFunction(stream) });

     function handlerFunction(stream) {
        rec = new MediaRecorder(stream);
        rec.ondataavailable = e => {
            audioChunks.push(e.data);
            if (rec.state == "inactive") {
                let blob = new Blob(audioChunks, {type: 'audio/mpeg-3'});
                sendData(blob);
            }
        }
    }

        function sendData(data) {
        var form = new FormData();
        var el = document.getElementById("rndWord");
        form.append('file', data, el.textContent);
        form.append('title', 'data.mp3');
        //Chrome inspector shows that the post data includes a file and a title.
        $.ajax({
            type: 'POST',
            url: '/save-record',
            data: form,
            cache: false,
            processData: false,
            contentType: false
        }).done(function(data) {
            console.log(data);
        });
    }

    function startTimer(time,display) {
        var timer = time;
        const stfunc = setInterval(function () {
            minutes = parseInt(timer / 60, 10)
            seconds = parseInt(timer % 60, 10);
            minutes = minutes < 10 ? "0" + minutes : minutes;
            seconds = seconds < 10 ? "0" + seconds : seconds;
            display.textContent = minutes + ":" + seconds;
            ++timer
            }, 1000);
    }

    function changeStyle(){
            var element = document.getElementById("safeTimerDisplay");
            element.style.visibility  = "hidden";
        }


    startRecording.onclick = e => {
        console.log('Recording are started..');
        startRecording.disabled = true;
        var time = 0
        display = document.querySelector('#safeTimerDisplay');
        startTimer(time ,display);
        const record = document.getElementById('msg');
        record.style.visibility = "visible";
        record.textContent = 'Recording...';
        audioChunks = [];
        rec.start();
    };

    stopRecording.onclick = e => {
        console.log("Recording are stopped.");
        nextWord.disabled = false;
        stopRecording.disabled = true;
        startRecording.disabled = true;
        changeStyle()
        const record = document.getElementById('msg');
        record.textContent = 'Recorded!';
        rec.stop();
    };

    nextWord.onclick = e => {
        window.location.reload(true)
    };
</script>
</html>